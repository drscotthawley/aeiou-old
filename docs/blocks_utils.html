---

title: blocks_utils


keywords: fastai
sidebar: home_sidebar

summary: "Utils from https://github.com/zqevans/audio-diffusion/blob/main/blocks/utils.py"
description: "Utils from https://github.com/zqevans/audio-diffusion/blob/main/blocks/utils.py"
nb_path: "nbs/blocks_utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/blocks_utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="append_dims" class="doc_header"><code>append_dims</code><a href="https://github.com/drscotthawley/shazbot/tree/master/shazbot/blocks_utils.py#L13" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>append_dims</code>(<strong><code>x</code></strong>, <strong><code>target_dims</code></strong>)</p>
</blockquote>
<p>Appends dimensions to the end of a tensor until it has target_dims dimensions.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="n_params" class="doc_header"><code>n_params</code><a href="https://github.com/drscotthawley/shazbot/tree/master/shazbot/blocks_utils.py#L21" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>n_params</code>(<strong><code>module</code></strong>)</p>
</blockquote>
<p>Returns the number of trainable parameters in a module.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="train_mode" class="doc_header"><code>train_mode</code><a href="https://github.com/drscotthawley/shazbot/tree/master/shazbot/blocks_utils.py#L26" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>train_mode</code>(<strong><code>model</code></strong>, <strong><code>mode</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>A context manager that places a model into training mode and restores
the previous mode on exit.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="eval_mode" class="doc_header"><code>eval_mode</code><a href="https://github.com/drscotthawley/shazbot/tree/master/shazbot/blocks_utils.py#L38" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>eval_mode</code>(<strong><code>model</code></strong>)</p>
</blockquote>
<p>A context manager that places a model into evaluation mode and restores
the previous mode on exit.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ema_update" class="doc_header"><code>ema_update</code><a href="https://github.com/drscotthawley/shazbot/tree/master/shazbot/blocks_utils.py#L44" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ema_update</code>(<strong><code>model</code></strong>, <strong><code>averaged_model</code></strong>, <strong><code>decay</code></strong>)</p>
</blockquote>
<p>Incorporates updated model parameters into an exponential moving averaged
version of a model. It should be called after each optimizer step.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="EMAWarmup" class="doc_header"><code>class</code> <code>EMAWarmup</code><a href="https://github.com/drscotthawley/shazbot/tree/master/shazbot/blocks_utils.py#L63" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>EMAWarmup</code>(<strong><code>inv_gamma</code></strong>=<em><code>1.0</code></em>, <strong><code>power</code></strong>=<em><code>1.0</code></em>, <strong><code>min_value</code></strong>=<em><code>0.0</code></em>, <strong><code>max_value</code></strong>=<em><code>1.0</code></em>, <strong><code>start_at</code></strong>=<em><code>0</code></em>, <strong><code>last_epoch</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Implements an EMA warmup using an inverse decay schedule.
If inv_gamma=1 and power=1, implements a simple average. inv_gamma=1, power=2/3 are
good values for models you plan to train for a million or more steps (reaches decay
factor 0.999 at 31.6K steps, 0.9999 at 1M steps), inv_gamma=1, power=3/4 for models
you plan to train for less (reaches decay factor 0.999 at 10K steps, 0.9999 at
215.4k steps).
Args:
    inv_gamma (float): Inverse multiplicative factor of EMA warmup. Default: 1.
    power (float): Exponential factor of EMA warmup. Default: 1.
    min_value (float): The minimum EMA decay rate. Default: 0.
    max_value (float): The maximum EMA decay rate. Default: 1.
    start_at (int): The epoch to start averaging at. Default: 0.
    last_epoch (int): The index of last epoch. Default: 0.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="InverseLR" class="doc_header"><code>class</code> <code>InverseLR</code><a href="https://github.com/drscotthawley/shazbot/tree/master/shazbot/blocks_utils.py#L111" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>InverseLR</code>(<strong><code>optimizer</code></strong>, <strong><code>inv_gamma</code></strong>=<em><code>1.0</code></em>, <strong><code>power</code></strong>=<em><code>1.0</code></em>, <strong><code>warmup</code></strong>=<em><code>0.0</code></em>, <strong><code>final_lr</code></strong>=<em><code>0.0</code></em>, <strong><code>last_epoch</code></strong>=<em><code>-1</code></em>, <strong><code>verbose</code></strong>=<em><code>False</code></em>) :: <code>_LRScheduler</code></p>
</blockquote>
<p>Implements an inverse decay learning rate schedule with an optional exponential
warmup. When last_epoch=-1, sets initial lr as lr.
inv_gamma is the number of steps/epochs required for the learning rate to decay to
(1 / 2)**power of its original value.
Args:
    optimizer (Optimizer): Wrapped optimizer.
    inv_gamma (float): Inverse multiplicative factor of learning rate decay. Default: 1.
    power (float): Exponential factor of learning rate decay. Default: 1.
    warmup (float): Exponential warmup factor (0 &lt;= warmup &lt; 1, 0 to disable)
        Default: 0.
    final_lr (float): The final learning rate. Default: 0.
    last_epoch (int): The index of last epoch. Default: -1.
    verbose (bool): If <code>True</code>, prints a message to stdout for
        each update. Default: <code>False</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>


